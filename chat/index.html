<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ChatBox UI</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/material-design-icons/3.0.1/iconfont/material-icons.min.css">
<style>
/* CSS styles for ChatBox UI */
html, body {
    background: #efefef;
    height: 100%;
    margin: 0;
    font-family: Arial, sans-serif;
}

#center-text {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100%;
}

#chat-circle {
    position: fixed;
    bottom: 50px;
    right: 50px;
    background: #5A5EB9;
    width: 80px;
    height: 80px;
    border-radius: 50%;
    color: white;
    padding: 28px;
    cursor: pointer;
    box-shadow: 0px 3px 16px 0px rgba(0, 0, 0, 0.6), 0 3px 1px -2px rgba(0, 0, 0, 0.2), 0 1px 5px 0 rgba(0, 0, 0, 0.12);
}

.chat-box {
    display: none;
    background: #efefef;
    position: fixed;
    right: 30px;
    bottom: 50px;
    width: 350px;
    max-width: 85vw;
    max-height: 100vh;
    border-radius: 5px;
    box-shadow: 0px 5px 35px 9px #ccc;
}

.chat-box-toggle {
    float: right;
    margin-right: 15px;
    cursor: pointer;
}

.chat-box-header {
    background: #5A5EB9;
    height: 70px;
    border-top-left-radius: 5px;
    border-top-right-radius: 5px;
    color: white;
    text-align: center;
    font-size: 20px;
    padding-top: 17px;
}

.chat-box-body {
    position: relative;
    height: 370px;
    border: 1px solid #ccc;
    overflow: hidden;
}

.chat-logs {
    padding: 15px;
    height: 300px; /* Initial height, adjust as needed */
    overflow-y: scroll;
}

.chat-logs .chat-msg {
    margin-bottom: 10px;
    clear: both;
}

.chat-logs .chat-msg.user .avatar {
    background-color: #5A5EB9;
    color: white;
    border-radius: 50%;
    width: 35px;
    height: 35px;
    text-align: center;
    line-height: 35px;
    float: left;
    margin-right: 10px;
}

.chat-logs .chat-msg.self .avatar {
    background-color: #2E7D32;
}

.chat-logs .chat-msg .msg-text {
    background: #fff;
    padding: 10px;
    border-radius: 15px;
    max-width: 70%;
    word-wrap: break-word;
    float: left;
}

.chat-input {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    background: #f4f7f9;
    padding: 10px;
    box-sizing: border-box;
    border-top: 1px solid #ccc;
}

#chat-input-text {
    width: calc(100% - 50px);
    padding: 5px;
    border: none;
    border-radius: 5px;
    margin-right: 5px;
}

#chat-submit-btn {
    width: 40px;
    height: 40px;
    border: none;
    border-radius: 50%;
    background-color: #5A5EB9;
    color: white;
    cursor: pointer;
    font-size: 20px;
}

#chat-submit-btn:hover {
    background-color: #3F51B5;
}
</style>
</head>
<body>

<div id="center-text">
    <h2>ChatBox UI</h2>
    <p>Message send and scroll to bottom enabled </p>
</div>

<div id="body">
    <div id="chat-circle" class="btn btn-raised">
        <div id="chat-overlay"></div>
        <i class="material-icons">speaker_phone</i>
    </div>

    <div class="chat-box">
        <div class="chat-box-header">
            Chat
            <span class="chat-box-toggle"><i class="material-icons">close</i></span>
        </div>
        <div class="chat-box-body">
            <div class="chat-logs" id="chat-logs">
                <!-- Chat messages will be loaded here -->
            </div>
        </div>
        <div class="chat-input">
            <input type="text" id="chat-input-text" placeholder="Send a message..." autocomplete="off">
            <button type="button" id="chat-submit-btn"><i class="material-icons">send</i></button>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    // Load messages when document is ready
    loadMessages();

    // Toggle chat box visibility
    $('#chat-circle, .chat-box-toggle').click(function() {
        $('.chat-box').toggle('scale');
    });

    // Handle message submission
    $('#chat-submit-btn').click(function() {
        var message = $('#chat-input-text').val().trim();
        if (message !== '') {
            sendMessage(message);
        }
    });

    // Function to load messages
    function loadMessages() {
        $.get('get_messages.php', function(data) {
            var messages = JSON.parse(data);
            var html = '';
            messages.forEach(function(msg) {
                html += generateMessage(msg.message, msg.email);
            });
            $('#chat-logs').html(html);
            scrollChatToBottom();
        });
    }

    // Function to send message
    function sendMessage(message) {
        $.post('send_message.php', { message: message }, function() {
            $('#chat-input-text').val('');
            loadMessages(); // Reload messages after sending
        });
    }

    // Function to generate HTML for message
    function generateMessage(message, email) {
        var type = (email === '<?php echo $_SESSION["email"]; ?>') ? 'self' : 'user';
        var avatarBg = (type === 'self') ? '#2E7D32' : '#5A5EB9';
        var html = '<div class="chat-msg ' + type + '">';
        html += '<div class="avatar" style="background-color: ' + avatarBg + '">';
        html += email.substring(0, 1).toUpperCase() + '</div>';
        html += '<div class="msg-text">' + message + '</div></div>';
        return html;
    }

    // Function to scroll chat to bottom
    function scrollChatToBottom() {
        $('#chat-logs').stop().animate({ scrollTop: $('#chat-logs')[0].scrollHeight }, 1000);
    }
});
</script>

</body>
</html>
